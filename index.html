<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Catch the Love</title>

<style>
@font-face { font-family: pixelLove; src: url(pixelLove.ttf); }

html, body {
  margin: 0; padding: 0; overflow: hidden;
  font-family: pixelLove, sans-serif;
  background: #1a1a2e; width: 100%; height: 100%;
  touch-action: none; user-select: none;
}

/* ---------- PAGE SYSTEM ---------- */
.page {
  position: absolute; width: 100%; height: 100%; top: 0; left: 100%;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  text-align: center; padding: 25px; box-sizing: border-box; z-index: 100;
  transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  visibility: hidden;
}
.page.active { transform: translateX(-100%); visibility: visible; }

/* INITIAL LOADING SCREEN (First 2 Seconds) */
#introLoading { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #1a1a2e; z-index: 1000; display: flex; 
    flex-direction: column; justify-content: center; align-items: center;
}
.loading-bella { width: 100px; height: 100px; image-rendering: pixelated; margin-bottom: 20px; }
.loading-text { color: #ff8fb1; font-size: 20px; letter-spacing: 4px; animation: pulse 1s infinite; }

/* TRANSITION PARTICLES */
.particle {
    position: absolute; pointer-events: none; z-index: 500;
    font-size: 24px; animation: particleAnim 1s forwards ease-out;
}
@keyframes particleAnim {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(0); opacity: 0; }
}

/* TITLE PAGE STYLING */
#titlePage { background: linear-gradient(to bottom, #1a1a40 0%, #4a1d4d 100%); }
#titlePage.active h1 { animation: slideIn 0.8s ease-out forwards; }
#titlePage.active .instruction { animation: slideIn 1s ease-out forwards; }

@keyframes slideIn { 0% { transform: translateY(30px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

#notePage { background: #4a1d4d; overflow-y: auto; display: block; padding-top: 60px;}

h1 { font-size: 52px; color: #ff8fb1; margin-bottom: 20px; letter-spacing: 4px; text-shadow: 4px 4px 0px rgba(0,0,0,0.3); }
.instruction { font-size: 14px; color: #ffffff; letter-spacing: 2px; line-height: 1.8; margin-bottom: 30px; text-transform: uppercase; }

.fs-toggle { color: #ffc2d1; font-size: 12px; margin-bottom: 20px; text-decoration: underline; cursor: pointer; }
.valentine-msg { color: #ffc2d1; font-size: 18px; line-height: 1.5; margin-bottom: 30px; }
.wiggle { display: inline-block; animation: wiggleAnim 0.3s infinite alternate ease-in-out; color: #ff4d6d; font-size: 24px; font-weight: bold; }
@keyframes wiggleAnim { from { transform: translateY(0); } to { transform: translateY(-8px); } }

.play-btn {
    background: #ff4d6d; border: 4px solid white; border-radius: 40px;
    padding: 15px 60px; color: white; font-size: 24px; font-weight: bold;
    cursor: pointer; box-shadow: 0 6px 0 #c02a46; transition: all 0.1s;
    text-transform: uppercase; letter-spacing: 2px; margin: 10px auto;
    display: block; width: fit-content;
}
.play-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #c02a46; }

/* ---------- GAME AREA ---------- */
#game { position: relative; width: 100vw; height: 100vh; overflow: hidden; background: #202040; }
#feverOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(255, 77, 109, 0.4) 0%, transparent 100%); opacity: 0; transition: opacity 0.5s; z-index: 1; pointer-events: none; }
.fever-active #feverOverlay { opacity: 1; animation: pulseFever 1s infinite alternate; }
@keyframes pulseFever { from { opacity: 0.3; } to { opacity: 0.7; } }
.bg { position: absolute; bottom: 0; left: 0; width: 100%; height: 110%; object-fit: cover; z-index: 0; pointer-events: none; }
.cloud { position: absolute; background-size: contain; background-repeat: no-repeat; z-index: 2; opacity: 0.6; pointer-events: none; }
.player { position: absolute; bottom: 40px; width: 90px; height: 90px; background-size: contain; background-repeat: no-repeat; image-rendering: pixelated; z-index: 10; filter: drop-shadow(0 10px 4px rgba(0,0,0,0.5)); }
.falling { position: absolute; width: 60px; height: 60px; background-size: contain; background-repeat: no-repeat; image-rendering: pixelated; z-index: 5; }
.score { position: absolute; top: 60px; left: 50%; transform: translateX(-50%); font-size: 50px; color: white; z-index: 50; text-shadow: 3px 3px 0px rgba(255, 77, 109, 0.5); }
.health { position: absolute; top: 60px; right: 20px; display: flex; gap: 5px; z-index: 50; }
.health img { width: 30px; height: 30px; image-rendering: pixelated; }
#feverBanner { position: absolute; top: 130px; left: 50%; transform: translateX(-50%); font-size: 32px; color: #ffeb3b; text-shadow: 3px 3px 0 #000; z-index: 50; display: none; }
.popup { position: absolute; font-size: 30px; color: #ffeb3b; text-shadow: 2px 2px 0 #000; pointer-events: none; z-index: 60; animation: floatUp 0.8s forwards; }
.flash { animation: blink 0.1s infinite; }
@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.2; } 100% { opacity: 1; } }
@keyframes screenShake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
@keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }
</style>
</head>
<body>

<div id="introLoading">
    <img src="sprites/Bella16bit.gif" class="loading-bella">
    <div class="loading-text">LOADING...</div>
</div>

<div class="page" id="titlePage">
  <h1>CATCH THE LOVE</h1>
  <div class="instruction">USE YOUR FINGER TO MOVE BELLA!<br>AVOID THE BOMBS!</div>
  <div class="fs-toggle" id="fsBtn">[ TOGGLE FULLSCREEN ]</div>
  <div class="play-btn" id="playBtnTitle">PLAY</div>
</div>

<div class="page" id="notePage">
  <div class="valentine-msg">
    <h2 style="color:white; margin-top:0;">Hey Baby, Happy Valentines Day!!!!</h2>
    <p>I know this is your first valentines having a valentine (me, hehe) so I wanted to make something special so you can remember this day whenever u get bored. It's not much but I hope you have fun!!!!!</p>
    
    <div>
      <span class="wiggle" style="animation-delay: 0s;">I</span>
      <span class="wiggle" style="animation-delay: 0.1s;">love</span>
      <span class="wiggle" style="animation-delay: 0.2s;">youuu!!</span>
    </div>
  </div>
  <div class="play-btn" id="startBtnGame">START</div>
</div>

<div class="page" id="gamePage">
  <div id="game">
    <div id="feverOverlay"></div>
    <img class="bg" src="bg.png" onerror="this.style.display='none'">
    <div class="score" id="scoreDisp">0</div>
    <div id="feverBanner">FEVER MODE!!</div>
    <div class="health" id="healthDisp"></div>
    <div class="player" id="player"></div>
  </div>
</div>

<div class="page" id="gameOverPage" style="background:rgba(0,0,0,0.9);">
  <h1 style="color:#ff4d6d;">GAME OVER</h1>
  <p id="finalScore" style="color:white; font-size:24px;"></p>
  <div class="play-btn" id="retryBtn">RETRY</div>
</div>

<audio id="noteMusic" src="audio/note.wav" loop preload="auto"></audio>
<audio id="startChime" src="audio/start.wav" preload="auto"></audio>
<audio id="gameMusic" src="audio/game.wav" loop preload="auto"></audio>
<audio id="pickupSound" src="audio/pickup.wav" preload="auto"></audio>
<audio id="hurtSound" src="audio/hurt.wav" preload="auto"></audio>
<audio id="buttonSound" src="audio/button.wav" preload="auto"></audio>

<script>
    const ASSETS = {
        player: "sprites/Bella16bit.gif",
        heart: "sprites/Heart.png",
        bomb: "sprites/Bomb.png",
        clouds: ["sprites/cloud1.png", "sprites/cloud2.png", "sprites/cloud3.png"],
        items: ["sprites/BlueFlower.png", "sprites/CatWhite.png", "sprites/Dog.png", "sprites/Dumpling.png", "sprites/Flower1.png", "sprites/Mango.png", "sprites/Racoon.png"]
    };

    const snd = {
        pickup: document.getElementById("pickupSound"),
        hurt: document.getElementById("hurtSound"),
        start: document.getElementById("startChime"),
        btn: document.getElementById("buttonSound"),
        game: document.getElementById("gameMusic"),
        note: document.getElementById("noteMusic")
    };

    let playerX = window.innerWidth/2-45, targetX = playerX;
    let score=0, health=3, combo=0, isFever=false, isImmune=false, isGameOver=false;
    let fallingItems=[], clouds=[], speedFall=4, spawnInterval;

    // --- INITIAL LOADING TRANSITION ---
    window.addEventListener('load', () => {
        setTimeout(() => {
            const intro = document.getElementById('introLoading');
            // Particle Burst
            for(let i=0; i<20; i++) {
                const p = document.createElement('div');
                p.className = 'particle'; p.innerHTML = "❤️";
                p.style.left = "50%"; p.style.top = "50%";
                p.style.setProperty('--dx', (Math.random()*400-200) + 'px');
                p.style.setProperty('--dy', (Math.random()*400-200) + 'px');
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 1000);
            }
            intro.style.opacity = '0';
            setTimeout(() => { intro.style.display = 'none'; slideTo("titlePage"); }, 500);
        }, 2000);
    });

    // --- AUDIO WARMUP LOGIC ---
    function primeAudio() {
        Object.values(snd).forEach(a => {
            if(a) {
                a.muted = true;
                a.play().then(() => { a.pause(); a.currentTime = 0; a.muted = false; }).catch(()=>{});
            }
        });
    }

    function slideTo(id) {
        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        document.getElementById(id).classList.add("active");
    }

    const setupBtn = (id, fn) => {
        const b = document.getElementById(id);
        b.addEventListener('click', fn);
        b.addEventListener('touchend', (e) => { e.preventDefault(); fn(); });
    };

    // --- BUTTON CLICKS ---
    setupBtn('playBtnTitle', () => {
        primeAudio(); // Initial nudge for browser
        snd.btn.play().catch(()=>{});
        // Start Note Music
        setTimeout(() => {
            snd.note.volume = 1;
            snd.note.play().catch(e => console.log("Note blocked"));
            slideTo("notePage");
        }, 100);
    });

    setupBtn('startBtnGame', () => {
        const btn = document.getElementById('startBtnGame');
        btn.innerText = "LOADING...";
        
        // Final warm up for game sounds
        primeAudio(); 

        setTimeout(() => {
            btn.innerText = "START";
            if(snd.note) snd.note.pause();
            snd.start.play().catch(()=>{});
            snd.game.play().catch(()=>{});
            slideTo("gamePage");
            initGame();
        }, 1000); // 1 second "loader" on the start button
    });

    setupBtn('retryBtn', () => {
        snd.game.currentTime = 0;
        snd.game.play().catch(()=>{});
        slideTo("gamePage");
        initGame();
    });

    setupBtn('fsBtn', () => {
        let doc = document.documentElement;
        if (!document.fullscreenElement) doc.requestFullscreen?.() || doc.webkitRequestFullscreen?.();
    });

    // --- GAME ENGINE ---
    const playerEl = document.getElementById("player");
    const gameContainer = document.getElementById("game");
    playerEl.style.backgroundImage = `url(${ASSETS.player})`;

    function initGame(){
      score=0; health=3; combo=0; isGameOver=false; speedFall=4;
      document.getElementById("scoreDisp").textContent=0;
      updateHealthUI();
      fallingItems.forEach(i=>i.el.remove()); fallingItems=[];
      clearInterval(spawnInterval);
      spawnInterval = setInterval(spawnItem, 800);
    }

    function updateHealthUI(){
      const hDisp = document.getElementById("healthDisp");
      hDisp.innerHTML="";
      for(let i=0; i<health; i++){
        const img=document.createElement("img");
        img.src=ASSETS.heart; hDisp.appendChild(img);
      }
    }

    function spawnItem(){
      if(isGameOver) return;
      const item=document.createElement("div");
      item.classList.add("falling");
      const rng = Math.random();
      let type = "normal", img = ASSETS.items[Math.floor(Math.random()*ASSETS.items.length)];
      if(rng < 0.15) { type = "bomb"; img = ASSETS.bomb; }
      else if(rng < 0.22 && health < 3) { type = "heart"; img = ASSETS.heart; }
      item.style.backgroundImage = `url(${img})`;
      const x = Math.random()*(window.innerWidth-60);
      item.style.left = x + "px"; item.style.top = "-70px";
      gameContainer.appendChild(item);
      fallingItems.push({el:item, y:-70, x: x, type: type});
    }

    window.addEventListener("touchmove", e => { targetX = e.touches[0].clientX - 45; }, {passive: true});
    window.addEventListener("mousemove", e => targetX = e.clientX - 45);

    function update() {
      if(!isGameOver && document.getElementById("gamePage").classList.contains("active")){
        playerX += (targetX - playerX) * 0.15;
        playerEl.style.left = playerX + "px";

        for(let i=fallingItems.length-1; i>=0; i--){
          let itm = fallingItems[i];
          itm.y += speedFall; itm.el.style.top = itm.y + "px";
          const iR = itm.el.getBoundingClientRect(), pR = playerEl.getBoundingClientRect();

          if(iR.bottom > pR.top + 20 && iR.top < pR.bottom - 10 && iR.left < pR.right - 20 && iR.right > pR.left + 20){
            if(itm.type === "bomb") { 
                health--; updateHealthUI(); snd.hurt.play().catch(()=>{}); 
                if(health <= 0) gameOver();
            } else if(itm.type === "heart") {
                health = Math.min(3, health+1); updateHealthUI();
            } else {
                score++; document.getElementById("scoreDisp").textContent = score;
                snd.pickup.currentTime=0; snd.pickup.play().catch(()=>{});
                speedFall += 0.02;
            }
            itm.el.remove(); fallingItems.splice(i,1);
          } else if(itm.y > window.innerHeight) {
            itm.el.remove(); fallingItems.splice(i,1);
          }
        }
      }
      requestAnimationFrame(update);
    }

    function gameOver(){
      isGameOver = true; snd.game.pause();
      document.getElementById("finalScore").textContent="Final Score: " + score;
      slideTo("gameOverPage");
    }
    update();
</script>
</body>
</html>
